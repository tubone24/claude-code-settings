{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\np=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nBLOCKED=(\".env\" \".env.local\" \".env.production\" \"credentials\" \"secrets\" \".ssh\" \"id_rsa\" \"id_ed25519\" \".pem\" \".key\" \"serviceAccount\" \".npmrc\" \".pypirc\")\nfor b in \"${BLOCKED[@]}\"; do\n  if [[ \"$p\" == *\"$b\"* ]]; then\n    echo \"[Hook] BLOCKED: Cannot edit sensitive file: $p\" >&2\n    exit 2\n  fi\ndone\necho \"$input\""
          }
        ],
        "description": "Block editing sensitive files (.env, credentials, keys)"
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\ncmd=$(echo \"$input\" | jq -r '.tool_input.command // \"\"')\nif echo \"$cmd\" | grep -qE 'git push.*(--force|-f)'; then\n  echo '[Hook] BLOCKED: Force push is dangerous. Use --force-with-lease if necessary.' >&2\n  exit 2\nfi\nif echo \"$cmd\" | grep -qE 'rm -rf /|:(){ :|:& };:|> /dev/sd|mkfs\\.|dd if='; then\n  echo '[Hook] BLOCKED: Potentially destructive command detected' >&2\n  exit 2\nfi\necho \"$input\""
          }
        ],
        "description": "Block dangerous commands (force push, rm -rf /, etc)"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"git push\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\necho '[Hook] git push detected - ensure changes are reviewed' >&2\nosascript -e 'display notification \"git pushを実行します\" with title \"Claude Code\" sound name \"Ping\"' 2>/dev/null || true\necho \"$input\""
          }
        ],
        "description": "Notify before git push"
      },
      {
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\\\.(md|txt)$\" && !(tool_input.file_path matches \"README\\\\.md|CLAUDE\\\\.md|AGENTS\\\\.md|CONTRIBUTING\\\\.md|context-snapshot\\\\.md\")",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nif [[ \"$file_path\" =~ \\.(md|txt)$ ]] && [[ ! \"$file_path\" =~ (README|CLAUDE|AGENTS|CONTRIBUTING|context-snapshot)\\.md$ ]]; then\n  echo \"[Hook] BLOCKED: Unnecessary documentation file creation\" >&2\n  echo \"[Hook] File: $file_path\" >&2\n  exit 1\nfi\necho \"$input\""
          }
        ],
        "description": "Block creation of random .md files"
      }
    ],
    "PostToolUse": [
      {
        "matcher": "tool == \"Bash\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\ncmd=$(echo \"$input\" | jq -r '.tool_input.command')\nif echo \"$cmd\" | grep -qE 'gh pr create'; then\n  output=$(echo \"$input\" | jq -r '.tool_output.output // \"\"')\n  pr_url=$(echo \"$output\" | grep -oE 'https://github.com/[^/]+/[^/]+/pull/[0-9]+')\n  if [ -n \"$pr_url\" ]; then\n    echo \"[Hook] PR created: $pr_url\" >&2\n    osascript -e \"display notification \\\"PR作成完了: $pr_url\\\" with title \\\"Claude Code\\\" sound name \\\"Hero\\\"\" 2>/dev/null || true\n  fi\nfi\necho \"$input\""
          }
        ],
        "description": "Notify PR creation"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  if command -v black >/dev/null 2>&1; then\n    black --check \"$file_path\" 2>&1 | head -3 >&2 || echo \"[Hook] black: format issues detected\" >&2\n  fi\n  if command -v mypy >/dev/null 2>&1; then\n    mypy \"$file_path\" --no-error-summary 2>&1 | head -5 >&2 || true\n  fi\nfi\necho \"$input\""
          }
        ],
        "description": "Python: Check formatting (black) and types (mypy)"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.ts$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  if command -v npx >/dev/null 2>&1; then\n    npx tsc --noEmit \"$file_path\" 2>&1 | head -5 >&2 || true\n  fi\nfi\necho \"$input\""
          }
        ],
        "description": "TypeScript: Check types (tsc --noEmit)"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx|js|jsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  command -v prettier >/dev/null 2>&1 && prettier --write \"$file_path\" 2>&1 | head -3 >&2\nfi\necho \"$input\""
          }
        ],
        "description": "Auto-format JS/TS with Prettier"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  console_logs=$(grep -n \"console\\\\.log\" \"$file_path\" 2>/dev/null || true)\n  [ -n \"$console_logs\" ] && echo \"[Hook] WARNING: console.log found\" >&2\nfi\necho \"$input\""
          }
        ],
        "description": "Warn about console.log"
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\n\n# Save context snapshot\nSNAPSHOT_DIR=\"$HOME/.claude/snapshots\"\nmkdir -p \"$SNAPSHOT_DIR\"\nSNAPSHOT_FILE=\"$SNAPSHOT_DIR/context-$(date '+%Y%m%d-%H%M%S').md\"\n\ncat > \"$SNAPSHOT_FILE\" << 'SNAPSHOT_EOF'\n# Context Snapshot\n**Date:** $(date '+%Y-%m-%d %H:%M:%S')\n**Directory:** $(pwd)\n\n## Recent Git Changes\n$(git diff --stat HEAD 2>/dev/null | tail -20 || echo 'No git repo')\n\n## Modified Files (uncommitted)\n$(git status --short 2>/dev/null | head -20 || echo 'N/A')\n\n## Recent Commands (from history)\nSee ~/.claude/logs/agent-$(date '+%Y%m%d').log\nSNAPSHOT_EOF\n\necho \"[Hook] Context snapshot saved: $SNAPSHOT_FILE\" >&2\necho \"$input\"",
            "timeout": 10
          }
        ],
        "description": "Save context snapshot on stop"
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nif git rev-parse --git-dir > /dev/null 2>&1; then\n  files=$(git diff --name-only HEAD 2>/dev/null | grep -E '\\.(ts|tsx|js|jsx)$' || true)\n  [ -n \"$files\" ] && while IFS= read -r f; do\n    [ -f \"$f\" ] && grep -q \"console\\.log\" \"$f\" 2>/dev/null && echo \"[Hook] WARNING: console.log in $f\" >&2\n  done <<< \"$files\"\nfi\necho \"$input\""
          }
        ],
        "description": "Final audit for console.log"
      }
    ],
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\nmkdir -p ~/.claude/logs ~/.claude/snapshots\necho \"[$(date '+%Y-%m-%d %H:%M:%S')] SESSION START in $(pwd)\" >> ~/.claude/logs/agent-$(date '+%Y%m%d').log"
          }
        ],
        "description": "Log session start"
      }
    ],
    "Notification": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "osascript -e 'display notification \"Claude Codeが許可を求めています\" with title \"Claude Code\" subtitle \"確認待ち\" sound name \"Glass\"'"
          }
        ],
        "description": "Notify permission request with sound"
      }
    ],
    "SessionEnd": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\necho \"[$(date '+%H:%M:%S')] SESSION END\" >> ~/.claude/logs/agent-$(date '+%Y%m%d').log\nosascript -e 'display notification \"セッションが終了しました\" with title \"Claude Code\" subtitle \"処理完了\" sound name \"Hero\"' 2>/dev/null || true\npython3 ~/.claude/plugins/claude-code-settings/hooks/scripts/obsidian-export.py 2>/dev/null || true",
            "timeout": 30
          }
        ],
        "description": "Notify session end and export to Obsidian"
      }
    ]
  }
}
