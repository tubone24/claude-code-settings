---
description: エージェント使用ガイドとコンテキスト最適化
---

# エージェントオーケストレーション

## コンテキスト最適化の原則

サブエージェントは独立したコンテキストウィンドウで動作するため、MCPより効率的:
1. **MCPよりサブエージェントを優先** - 独立コンテキストで処理
2. **サマリーのみ返却** - 詳細データはメインコンテキストに流さない
3. **大量データはファイル出力** - ログや分析結果はファイルに保存
4. **並列実行でターン数削減** - 独立タスクは同時実行

## 利用可能なエージェント

`~/.claude/agents/`にあります:

### 開発系
| エージェント | 目的 | 使用タイミング |
|-------------|------|----------------|
| planner | 実装計画 | 複雑な機能、リファクタリング |
| architect | システム設計 | アーキテクチャの決定 |
| tdd-guide | テスト駆動開発 | 新機能、バグ修正 |
| code-reviewer | コードレビュー | コードを書いた後 |
| build-error-resolver | ビルドエラー修正 | ビルドが失敗した時 |
| refactor-cleaner | デッドコードのクリーンアップ | コードメンテナンス |

### 運用系（MCP代替）
| エージェント | 目的 | MCP代替 |
|-------------|------|---------|
| github-ops | GitHub操作 | GitHub MCP |
| database-ops | DB操作 | Supabase MCP |
| deploy-ops | デプロイ | Vercel MCP |
| doc-updater | ドキュメント更新 | - |
| docs-lookup | ドキュメント検索 | Context7 MCP |

### ブラウザ系（MCP代替・コンテキスト93%削減）
| エージェント | 目的 | MCP代替 |
|-------------|------|---------|
| browser-automation | ブラウザ自動操作 | Playwright MCP |
| browser-debug | パフォーマンス分析 | Chrome DevTools MCP |
| e2e-runner | E2Eテスト | - |

### セキュリティ系
| エージェント | 目的 | 使用タイミング |
|-------------|------|----------------|
| security-reviewer | セキュリティ分析 | コミット前 |

### メタ・調整系
| エージェント | 目的 | 使用タイミング |
|-------------|------|----------------|
| orchestrator | 複数エージェント調整 | 大規模・複雑なタスク |

## 即時エージェント使用

ユーザープロンプト不要で自動的に使用:
1. 複雑な機能リクエスト → **planner**
2. コードを書いた/修正した直後 → **code-reviewer**
3. バグ修正または新機能 → **tdd-guide**
4. アーキテクチャの決定 → **architect**
5. ドキュメント参照が必要 → **docs-lookup**
6. 大規模タスク → **orchestrator**

## 並列タスク実行

独立した操作には常に並列Task実行を使用:

```markdown
# 良い例: 並列実行（コンテキスト効率が高い）
3つのエージェントを並列で起動:
1. security-reviewer: auth.tsのセキュリティ分析
2. code-reviewer: キャッシュシステムのレビュー
3. tdd-guide: utils.tsのテスト作成

# 悪い例: 不要な順次実行
まずエージェント1、次にエージェント2、次にエージェント3
```

## MCPからサブエージェントへの移行

| 従来（MCP） | 推奨（サブエージェント） | 効果 |
|------------|------------------------|------|
| Playwright MCP | browser-automation | 93%削減 |
| Chrome DevTools MCP | browser-debug | 大幅削減 |
| Context7 MCP | docs-lookup | 大幅削減 |
| GitHub MCP | github-ops | 大幅削減 |
| Supabase MCP | database-ops | 大幅削減 |

## マルチパースペクティブ分析

複雑な問題には、分割ロールのサブエージェントを使用:
- 事実確認レビュアー
- シニアエンジニア
- セキュリティエキスパート
- 一貫性レビュアー
- 冗長性チェッカー

## コンテキスト節約のベストプラクティス

1. **snapshot -i を使う** - agent-browserで必要最小限の情報のみ取得
2. **詳細はファイル出力** - 分析結果、ログ、レポートはファイルに保存
3. **リンクで参照** - 長いドキュメントはURLを提示
4. **要約を返す** - サブエージェントからは3-5行のサマリーのみ
5. **haiku モデル活用** - 単純なタスクには軽量モデルを使用
